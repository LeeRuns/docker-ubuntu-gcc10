name: Build and Deploy
on: [push]
jobs:
  base:
    if: False
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Build Docker Base Image
      run: |
        docker-compose pull base
        docker-compose build base
    - name: Inspect Docker image uilianries/base
      run: docker inspect uilianries/base
    - name: Docker login
      run: docker login -u "${{ secrets.DOCKER_USERNAME }}" -p "${{ secrets.DOCKER_PASSWORD }}"
    - name: Docker Upload image uilianries/base
      run: docker push uilianries/base
  conanfy-gcc:
    if: False
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        version: [gcc5-conanfy, gcc6-conanfy, gcc7-conanfy, gcc8-conanfy, gcc9-conanfy, gcc10-conanfy]
    steps:
    - uses: actions/checkout@master
    - name: Build ${{ matrix.version }}
      run: |
        docker-compose pull ${{ matrix.version }}
        docker-compose build --build-arg CONAN_PASSWORD=${{ secrets.CONAN_PASSWORD }} --build-arg CONAN_LOGIN_USERNAME=${{ secrets.CONAN_LOGIN_USERNAME }} ${{ matrix.version }}
    - name: Docker login
      run: docker login -u "${{ secrets.DOCKER_USERNAME }}" -p "${{ secrets.DOCKER_PASSWORD }}"
    - name: Docker Upload image uilianries/${{ matrix.version }}
      run: docker push uilianries/${{ matrix.version }}
  build-gcc:
    if: False
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        version: [gcc5, gcc6, gcc7, gcc8, gcc9, gcc10]
    steps:
    - uses: actions/checkout@master
    - name: Build ${{ matrix.version }}
      run: |
        docker-compose pull ${{ matrix.version }}
        docker-compose build ${{ matrix.version }}
    - name: Inspect Docker image uilianries/${{ matrix.version }}
      run: docker inspect uilianries/${{ matrix.version }}
    - name: Docker login
      run: docker login -u "${{ secrets.DOCKER_USERNAME }}" -p "${{ secrets.DOCKER_PASSWORD }}"
    - name: Docker Upload image uilianries/${{ matrix.version }}
      run: docker push uilianries/${{ matrix.version }}
  test-gcc:
    if: False
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        version: [gcc5, gcc6, gcc7, gcc8, gcc9, gcc10]
    steps:
    - uses: actions/checkout@master
    - name: Test ${{ matrix.version }}
      run: |
        chmod +x test/gcc/test_docker.sh
        chmod +x test/gcc/test_conan.sh
        chmod +x test/simple/test_docker.sh
        chmod +x test/simple/test_simple.sh
        test/simple/test_docker.sh ${{ matrix.version }}
        docker build -t uilianries/gcc-test --build-arg COMPILER=${{ matrix.version }} test/gcc
        test/gcc/test_docker.sh ${{ matrix.version }}
  conanfy-clang:
    runs-on: ubuntu-latest
    if: False
    strategy:
      fail-fast: false
      matrix:
        version: [clang6-conanfy, clang7-conanfy, clang8-conanfy, clang9-conanfy, clang10-conanfy, clang11-conanfy, clang12-conanfy]
    steps:
    - uses: actions/checkout@master
    - name: Build ${{ matrix.version }}
      run: |
        docker-compose pull ${{ matrix.version }}
        docker-compose build --build-arg CONAN_PASSWORD=${{ secrets.CONAN_PASSWORD }} --build-arg CONAN_LOGIN_USERNAME=${{ secrets.CONAN_LOGIN_USERNAME }} ${{ matrix.version }}
    - name: Docker login
      run: docker login -u "${{ secrets.DOCKER_USERNAME }}" -p "${{ secrets.DOCKER_PASSWORD }}"
    - name: Docker Upload image uilianries/${{ matrix.version }}
      run: docker push uilianries/${{ matrix.version }}
  build-clang:
    if: False
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        version: [clang6, clang7, clang8, clang9, clang10, clang11]
    steps:
    - uses: actions/checkout@master
    - name: Build ${{ matrix.version }}
      run: |
        docker-compose build ${{ matrix.version }}
    - name: Inspect Docker image uilianries/${{ matrix.version }}
      run: docker inspect uilianries/${{ matrix.version }}
    - name: Docker login
      run: docker login -u "${{ secrets.DOCKER_USERNAME }}" -p "${{ secrets.DOCKER_PASSWORD }}"
    - name: Docker Upload image uilianries/${{ matrix.version }}
      run: docker push uilianries/${{ matrix.version }}
  test-clang:
    if: False
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        version: [clang6, clang7, clang8, clang9, clang10, clang11]
    steps:
    - uses: actions/checkout@master
    - name: Test ${{ matrix.version }}
      run: |
        chmod +x test/clang/test_docker.sh
        chmod +x test/clang/test_conan.sh
        chmod +x test/simple/test_docker.sh
        chmod +x test/simple/test_simple.sh
        test/simple/test_docker.sh ${{ matrix.version }}
        docker build -t uilianries/clang-test --build-arg COMPILER=${{ matrix.version }} test/clang
        test/clang/test_docker.sh ${{ matrix.version }}
